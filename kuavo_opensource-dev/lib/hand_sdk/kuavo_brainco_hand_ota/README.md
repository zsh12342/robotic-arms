# 灵巧手OTA与恢复手的默认配置  
本仓库实现了对灵巧手固件进行OTA与恢复默认配置的功能。在脚本启动后，选择你想要的功能，根据提示选择需要操作的硬件设备（左手或右手），等待程序执行完毕即可。  
* 旧版本的手存在偶尔控制实效的问题，需要运行OTA功能更新固件  
* 如果灵巧手出现控制关节错位的情况，需要恢复手的默认配置
0. 进入目标文件夹
```bash
cd lib/hand_sdk/kuavo_brainco_hand_ota
```
1. 安装必要环境
```bash
sudo ./setup.sh
```
2. 启动配置脚本  
```bash
python3 main.py
```
## OTA功能
终端打印如下：
```bash
 
lab@NUC11TNKi7:~/kuavo_zlb/kuavo/lib/hand_sdk/kuavo_brainco_hand_ota$ python3 main.py 
请选择需要设置的功能：
1. OTA
2. 恢复手的配置
请输入选项 (1 或 2): 1
请选择设备名称：
1. /dev/stark_serial_L ：左手
2. /dev/stark_serial_R ：右手
请输入选项 (1 或 2): 2
----------------------Main begin----------------------
StarkSDK version: v0.1.0
Opening port.
Setting port to 115200 8N1, no flow control.
serial_device: 0x55dbbb531520
17:34:33 [INFO][StarkSDK:serial_cmd.c:793]>stark_start_dfu:stark_start_dfu, dfu_file_path=./ota_bin/hand.ota
.....
.....



Sending (112 bytes).
Sent 112 bytes successfully.
on_ota_progress, device_id: Stark_OK, progress: 100.0
on_ota_state, device_id: Stark_OK, dfu_state: COMPLETED
on_ota_state, device_id: Stark_OK, dfu_state: IDLE  
#出现该打印说明升级完成 ,直接关掉终端即可
```

## 恢复默认配置功能  
终端打印如下
```bash
lab@NUC11TNKi7:~/kuavo_zlb/kuavo/lib/hand_sdk/kuavo_brainco_hand_ota$ python3 main.py 
请选择需要设置的功能：
1. OTA
2. 恢复手的配置
请输入选项 (1 或 2): 2
请选择设备名称：
1. /dev/stark_serial_L ：左手
2. /dev/stark_serial_R ：右手
请输入选项 (1 或 2): 1
----------------------Main begin----------------------
StarkSDK version: v0.1.0
Opening port.
Setting port to 115200 8N1, no flow control.
17:37:47 [INFO][StarkSDK:serial_cmd.c:553]>stark_group_set_finger_speeds:stark_group_set_finger_speeds, msgId=1


Sending (28 bytes).
Sent 28 bytes successfully.
17:37:47 [INFO][StarkSDK:serial_cmd.c:545]>stark_group_set_finger_positions:stark_group_finger_positions, msgId=2


Sending (28 bytes).
Sent 28 bytes successfully.
17:37:47 [INFO][StarkSDK:serial_cmd.c:477]>stark_set_finger_positions:stark_set_finger_positions, msgId=3

Sending (28 bytes).
Sent 28 bytes successfully.
17:37:47 [INFO][StarkSDK:serial_cmd.c:153]>factory_set_hand_type:factory_set_hand_type, msgId=4, hand_type=2


Sending (44 bytes).
Sent 44 bytes successfully.
17:37:47 [INFO][StarkSDK:serial_cmd.c:218]>stark_get_motorboard_info:stark_get_motorboard_info, msgId=5


Sending (16 bytes).
Sent 16 bytes successfully.
Waiting for data...
Data waiting: 27 bytes.
Data waiting: 143 bytes.
Data waiting: 258 bytes.
Data waiting: 288 bytes.
Receiving 288 bytes data.
Received 288 bytes successfully.
0x42,0x6E,0x43,0x50,0x03,0x0A,0x00,0x04,0x22,0x02,0x18,0x01,0xD8,0x69,0x45,0x7F,0x42,0x6E,0x43,0x50,0x03,0x0A,0x01,0x04,0x2A,0x81,0x02,0x0A,0x12,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x12,0x07,0x39,0x2E,0x32,0x2E,0x37,0x2E,0x53,0x1D,0x7D,0x1D,0x04,0x41,0x22,0x08,0x0A,0x06,0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0x2A,0x92,0x01,0x0A,0x28,0x0A,0x0C,0xB4,0x01,0xB4,0x01,0xB4,0x01,0xB4,0x01,0xB4,0x01,0xB4,0x01,0x12,0x06,0x37,0x5A,0x46,0x46,0x46,0x46,0x1A,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x22,0x06,0x02,0x05,0x00,0x03,0x01,0x04,0x28,0x1C,0x12,0x3F,0x08,0x80,0x04,0x10,0x10,0x18,0x1C,0x20,0x06,0x28,0x05,0x30,0x0A,0x38,0x14,0x40,0xAC,0x02,0x48,0xC0,0xE4,0x04,0x50,0x80,0xD0,0x83,0x04,0x5A,0x22,0x08,0x12,0x21,0x32,0x46,0x5F,0x80,0x01,0xA0,0x01,0xC1,0x01,0xD5,0x01,0xE7,0x01,0xFA,0x01,0x93,0x02,0xAC,0x02,0xCA,0x02,0xE3,0x02,0x86,0x03,0xAE,0x03,0xEA,0x03,0xB0,0x04,0x1A,0x18,0x0A,0x06,0x3C,0x3C,0x3C,0x3C,0x3C,0x3C,0x12,0x06,0x32,0x32,0x32,0x32,0x32,0x32,0x1A,0x06,0x64,0x64,0x64,0x64,0x64,0x64,0x20,0x02,0x2A,0x09,0x08,0xE8,0x39,0x10,0x90,0x35,0x18,0xA0,0x1F,0x32,0x3E,0x08,0x03,0x12,0x06,0x32,0x32,0x32,0x32,0x32,0x32,0x1A,0x06,0x46,0x46,0x46,0x46,0x46,0x46,0x22,0x06,0x64,0x64,0x64,0x64,0x64,0x64,0x2A,0x06,0x69,0x7D,0x69,0x69,0x69,0x69,0x32,0x0C,0x87,0x01,0x87,0x01,0x87,0x01,0x87,0x01,0x87,0x01,0x87,0x01,0x3A,0x0C,0xAC,0x02,0xAC,0x02,0xAC,0x02,0xAC,0x02,0xAC,0x02,0xAC,0x02,0xC1,0x64,0xED,0x93
17:37:47 [INFO][StarkSDK:stark_message_handler.c:331]>stark_handle_data:MainFactoryResp resp: 0x55f7e5b18380

17:37:47 [INFO][StarkSDK:stark_message_handler.c:339]>stark_handle_data:board_sn: 000000000000000000, fw_version: 9.2.7.S, bat_volt: 8.257199, hand_type: 2

on_motorboard_info, device_id: Stark_OK, hand_type: 2, sn: 000000000000000000, fw_version: 9.2.7.S
17:37:47 [INFO][StarkSDK:stark_message_handler.c:354]>stark_handle_data:force_level: 3

17:37:50 [INFO][StarkSDK:serial_cmd.c:553]>stark_group_set_finger_speeds:stark_group_set_finger_speeds, msgId=6


Sending (28 bytes).
Sent 28 bytes successfully.
17:37:50 [INFO][StarkSDK:serial_cmd.c:545]>stark_group_set_finger_positions:stark_group_finger_positions, msgId=7


Sending (28 bytes).
Sent 28 bytes successfully.
Event loop finished
Closing port.  
#出现该打印说明恢复默认成功，手在恢复过程中会握紧再张开
```