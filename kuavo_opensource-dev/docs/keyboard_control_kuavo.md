## KUAVO机器人键盘控制文档

### 日期: 2024-04-23

### 分支：`dev`

### 按键说明:

* 启动机器人程序后，机器人会先进入下蹲状态，按下 `o` 键，机器人进入站立状态

* 通过按键 `m` 可以切换控制模式，包括速度控制、位置控制

* 在站立状态下才可以切换到行走、跳跃、下蹲等动作模式

  1. 按下 `r` 键, 进入行走状态
  2. 按下 `j` 键, 进入跳跃状态
  3. 按下 `p` 键, 进入下蹲状态
  4. 按下 `h` 和 `k` 键, 控制手爪开合(需要实物支持)
  5. 按下 `v` 键, 开启手臂规划， `b` 键关闭手臂规划

* 行走状态下

  1. 默认进入行走时是速度控制模式, 机器人进行原地踏步
  2. 按 `w`, `a`, `s`, `d` 控制机器人前后左右移动
  3. `q` , `e` 控制机器人左右旋转
  4. `w` , `a` , `s` , `d` 速度的变化量以及 `q` 和 `e` 旋转的角度基于配置文件 `$HOME/.config/lejuconfig/config/<ROBOT_VERSION>/kuavo.json` 的 `cmd_vel_step`
  5. 假如当前速度为 `v`, 按下 `w` 键, 机器人速度变为 `v + cmd_vel_step[index]`
  6. 配置文件中的 `VelocityLimit` 定义了 `w` , `a` , `s` , `d` 的速度上限
  7. 正在移动时, 按空格键, 机器人速度归零
  8. 按下 `c` 键, 退出走路状态, 回到站立状态

* 跳跃状态下

  1. 进入跳跃状态，机器人会先缓慢下蹲，等待下蹲到不动时才能进行起跳
  2. 按下空格键或者 `j` 键, 起跳
  3. 机器人会自动跳跃、落地，等待机器人站稳，可以再次按下空格键或者 `j` 键, 起跳
  4. 按下 `c` 键或 `q` 键, 退出跳跃状态, 回到站立状态

* 其他状态下

  1. 按下 `c` 键或者 `q` 键, 退出当前状态，回到站立状态


### 机器人配置文件说明:

* 在 `src/kuavo/src/opensource/common` 目录下的 `config` 文件存放了读取机器人配置文件的代码
  
* 基于环境变量 `ROBOT_VERSION` 来读取对应的配置文件，编译时根据预定义的 `ROBOT_VERSION` 的值来选择不同的配置路径

* 机器人配置文件的路径为 `src/kuavo/src/biped_v2/config/<ROBOT_VERSION>/kuavo.json`

* 程序运行时， 会从 `$HOME/.config/lejuconfig/` 目录下读取配置文件，配置文件如果不存在，则会从 `src/kuavo/src/biped_v2/config/` 拷贝文到该目录

* 通过 `JSONConfigReader` 类来读取配置文件，其中 `configHardware` 函数根据配置文件中的信息设置了机器人的参数。

* `MotorInfo` 结构体存储了关于机器人电机的信息，包括 ID、类型、驱动器类型等。`motor_config` 结构体定义了单个电机的配置信息，包括编码器范围、最大电流、转速到扭矩系数等。

* `GetAbsolutePath` 函数用于获取配置文件的绝对路径，这对于确保程序能够正确读取配置文件非常重要。
  
* 在程序中主要通过定义了一个 `getValue<T>("name")` 模版函数来获取配置文件中的参数，其中 `T` 是参数的类型, `name` 则是JSON配置文件中的Key。例如：`RobotConfig.getValue<std::string>("model_path")` 用于获取配置文件中的 `model_path` 参数。
