## KUAVO 日志上传工具

### 1. 简介

可以将 kuavo 的运行 log 通过局域网上传到局域网的服务器， 便于存档和调试的同事使用

### 2. 安装

```bash
cd dev_tools/upload_kuavo_log_tool
sudo chmod +x setup.sh
./setup.sh
```

工具会被安装到 `/usr/local/bin` 目录下, 在 `kuavo` 目录的终端下输入 `sudo upload_kuavo_log` 即可启动。

### 3. 使用

1. **复制本地公钥到服务器** 为了方便上传文件到服务器，需要将本地的公钥复制到服务器上，这样上传文件就无需密码了。在终端输入以下命令 `ssh-copy-id -p 2222 root@192.168.3.10`，将本地公钥复制到服务器上, 第一次执行此命令时需要输入密码，密码就是 `123456`。

2. **启动程序**  在 `kuavo` 目录的终端输入 `sudo upload_kuavo_log` 启动程序，选择**退出**或者 `Ctrl+C` 退出程序。

3. **配置机器人编号** 程序会提示输入机器人编号（例如 3-24，3-25），输入后程序会将机器人编号保存到配置文件中，下次启动程序时会自动加载，并询问是否需要更改。

4. **选择上传文件** 程序会罗列出 `/var/lcm_log` 中 24 小时内的 `bin` 文件，通过方向键选择需要上传的文件，按 `Enter` 确认。确认后程序会将文件转换为 `csv` 格式(如果文件记录的时长大于 60 秒，则会保留最后 60 秒的数据)，同时程序会根据 `bin` 文件名中的时间戳，找出对应的终端日志输出 `txt` 文件，将 `csv` 和 `txt` 上传到公司内部服务器服务器。

5. **查看上传结果** 上传成功后，程序会显示上传的文件名，以及日志下载链接，可以通过浏览器打开链接下载到本地。

### 4. 使用示例

![upload_kuavo_log](./imgs/upload_kuavo_log.gif)

### 4. 注意事项

1. 程序会将日志 `bin` 文件转换为 `csv` 格式的日志，因此需要找到 `bin2csv` 程序路径，所以运行时需要在 `kuavo` 目录下运行，并且 `kuavo` 已经编译过。若找不到 `bin2csv` 程序路径，程序则会要求用户输入 `bin2csv` 程序的路径。
2. 程序会在上传 `csv` 文件时先检查是否有对应的终端输出 `txt` 文件，若没有则会提示找不到对应的终端输出 `txt` 文件。
3. 程序在上传文件前会先检查服务器 IP 地址是否可达，若不可达则会提示用户提供新的上传地址，同时上传后不会有下载链接。
4. 为了区分日志是属于哪一个机器人的，所有上传的日志文件名的结尾都会追加机器人网卡编号和机器人编号。
